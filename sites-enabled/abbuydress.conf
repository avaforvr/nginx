server {
    listen      80;
    server_name dev.abbuydress.com *.abbuydress.com;
    client_max_body_size 200m;
    access_log  logs/abbuydress.access.log  main;
    root   D:/zwnmp/web/abbuydress;
    index  index.html index.htm index.php;
    set $v5path D:/zwnmp/web/jjshouse/v5/;

    rewrite ^(/..)?/[^\/]*-c([0-9]+)(.*)$ /filter.php?cat_id=$2&filter=$3 last;
    rewrite /[^\/]+-a([0-9]+)(.*)$ /category.php?attr_id=$1&filter=$2 last;
    rewrite /[^\/]*-g([0-9]+)\/?$ /goods.php?goods_id=$1 last;
    rewrite /search/([^\/]+)\/?$  /search.php?q=$1 last;

    #new products
    rewrite /new\-products\/(\d+\-\d+\-\d+)?\/?$ /new_products.php?date=$1 last;
    rewrite /new\-products\/(\d+\-\d+\-\d+)?\/p(\d*)\/?$ /new_products.php?date=$1&page=$2 last;

    #questions and reviews
    rewrite /qa\/[^\/]+-cid([0-9]+)-q([0-9]+)\/?$ /goods_question.php?cat_id=$1&goods_id=$2 last;
    rewrite /reviews\/?$ /reviews.php last;
    rewrite /reviews\/[^\/]+-c([0-9]+)\/?$ /reviews.php?cat_id=$1 last;
    #rewrite /reviews\/[^\/]+-cid([0-9]+)-p([0-9]+)\/?$ /reviews.php?cat_id=$1&comment_id=$2 last;
    rewrite /reviews\/[^\/]+-cid([0-9]+)-p([0-9]+)\/?$ /reviews.php?cat_id=$1&goods_id=$2 last;

    #tag
    rewrite /tag/([^\/]+)\/?$  /tag/index.php?q=$1 last;
    rewrite /tag/([^\/]+)/([^\/]+)\/?$  /search.php?q=$2 last;

    #promotion
    rewrite /promotion/([^\/]+)\/?$  /promotion/index.php?code=$1 last;
    rewrite /(wholesale-weekly-deal)\/?$  /promotion/index.php?code=$1 last;

    #return policy
    rewrite /return\/?$ /about/help.php?page_id=84 last;

    #region seo
    rewrite /region\/?$ /region_seo.php last;
    rewrite /region/(\w+)-region\/?$ /region_seo.php?region_code=$1 last;
    rewrite /region\/[^\/]+-state-code-(\w+)-(\w+)\/?$ /region_seo.php?region_code=$1&state_code=$2 last;
    rewrite /region\/[^\/]+-r([0-9]+)\/?$ /region_seo.php?region_id=$1 last;
    rewrite /region\/[^\/]+-r([0-9]+)c([0-9]+)\/?$ /region_seo.php?region_id=$1&cat_id=$2 last;

    #activities
    rewrite /(2013-black-friday)\/?$  /black_friday.php?code=$1 last;
    rewrite /(2013-year-end-sale)\/?$  /year_end_sale.php?code=$1 last;
    rewrite /(2014-Prom)\/?$  /promotion/prom.php?code=$1 last;
    rewrite ^/(.*)2013-Christmas-Sale\/?$ /$1christmas_sale.php last;
    rewrite ^/(.*)win-ipad-mini\/?$ /promotion/winIpadMini.php last;

    #help
    rewrite /about-us\/?$  /about/help.php?page_id=2 last;
    rewrite /testimonials\/?$  /about/help.php?page_id=3 last;
    rewrite /our-guarantee\/?$  /about/help.php?page_id=5 last;
    rewrite /contacts\/?$  /about/help.php?page_id=30 last;
    rewrite /faq\/?$  /about/help.php?page_id=8 last;
    rewrite /return-policy\/?$  /about/help.php?page_id=84 last;
    rewrite /shipping-guide\/?$  /about/help.php?page_id=10 last;
    rewrite /payment-methods\/?$  /about/help.php?page_id=9 last;
    rewrite /terms-and-conditions\/?$  /about/help.php?page_id=85 last;
    rewrite /privacy-notice\/?$  /about/help.php?page_id=86 last;
    rewrite /estimate-delivery-time\/?$  /about/help.php?page_id=11 last;

    #第四个分类 有很多行 大概三十行
    rewrite (?i)/(accessories-shoes\.html)(.*)$ /filter.php?route=$1 last;
    rewrite (?i)/(wedding-shoes\.html)(.*)$ /filter.php?route=$1 last;
    rewrite (?i)/(cheap-wedding-flats-for-sale\.html)(.*)$ /filter.php?route=$1 last;
    rewrite (?i)/(cheap-high-heel-pumps-on-sales\.html)(.*)$ /filter.php?route=$1 last;
    rewrite (?i)/(cheap-wedding-sandals-online\.html)(.*)$ /filter.php?route=$1 last;
    rewrite (?i)/(cheap-fashion-boots-uk\.html)(.*)$ /filter.php?route=$1 last;
    rewrite (?i)/(cheap-platform-heels-shoes-sale\.html)(.*)$ /filter.php?route=$1 last;
    rewrite (?i)/(wedding-jewelry\.html)(.*)$ /filter.php?route=$1 last;
    rewrite (?i)/(wedding-jewelry-sets\.html)(.*)$ /filter.php?route=$1 last;
    rewrite (?i)/(wedding-jewelry-necklaces\.html)(.*)$ /filter.php?route=$1 last;
    rewrite (?i)/(sexy-lingerie\.html)(.*)$ /filter.php?route=$1 last;
    rewrite (?i)/(best-selling-wedding-shoes\.html)(.*)$ /filter.php?route=$1 last;
    rewrite (?i)/(accessories-shoes-for-sale-weekly\.html)(.*)$ /filter.php?route=$1 last;
    rewrite (?i)/(accessories-shoes-new-arrival\.html)(.*)$ /filter.php?route=$1 last;
    rewrite (?i)/(best-selling-wedding-shoes\.html)(.*)$ /filter.php?route=$1 last;

    rewrite (?i)/(accessories-shoes)\/?(.*)$ /filter.php?route=$1&filter=$2 last;
    rewrite (?i)/(wedding-shoes)\/?(.*)$ /filter.php?route=$1&filter=$2 last;
    rewrite (?i)/(cheap-wedding-flats-for-sale)\/?(.*)$ /filter.php?route=$1&filter=$2 last;
    rewrite (?i)/(cheap-high-heel-pumps-on-sales)\/?(.*)$ /filter.php?route=$1&filter=$2 last;
    rewrite (?i)/(cheap-wedding-sandals-online)\/?(.*)$ /filter.php?route=$1&filter=$2 last;
    rewrite (?i)/(cheap-fashion-boots-uk)\/?(.*)$ /filter.php?route=$1&filter=$2 last;
    rewrite (?i)/(cheap-platform-heels-shoes-sale)\/?(.*)$ /filter.php?route=$1&filter=$2 last;
    rewrite (?i)/(wedding-jewelry)\/?(.*)$ /filter.php?route=$1&filter=$2 last;
    rewrite (?i)/(wedding-jewelry-sets)\/?(.*)$ /filter.php?route=$1&filter=$2 last;
    rewrite (?i)/(wedding-jewelry-necklaces)\/?(.*)$ /filter.php?route=$1&filter=$2 last;
    rewrite (?i)/(sexy-lingerie)\/?(.*)$ /filter.php?route=$1&filter=$2 last;
    rewrite (?i)/(best-selling-wedding-shoes)\/?(.*)$ /filter.php?route=$1&filter=$2 last;
    rewrite (?i)/(accessories-shoes-for-sale-weekly)\/?(.*)$ /filter.php?route=$1&filter=$2 last;
    rewrite (?i)/(accessories-shoes-new-arrival)\/?(.*)$ /filter.php?route=$1&filter=$2 last;
    rewrite (?i)/(best-selling-wedding-shoes)\/?(.*)$ /filter.php?route=$1&filter=$2 last;

    #对几个sale_weekly_deal结尾的转发
    rewrite (?i)/([^\/]+-sale-weekly-deal\.html)(.*)$ /filter.php?route=$1 last;
    rewrite (?i)/([^\/]+-sale-weekly-deal)\/?(.*)$ /filter.php?route=$1&filter=$2 last;

    #对几个以new-arrival结尾的转发
    rewrite (?i)/([^\/]+-new-arrival\.html)(.*)$ /filter.php?route=$1 last;
    rewrite (?i)/([^\/]+-new-arrival)\/?(.*)$ /filter.php?route=$1&filter=$2 last;

    #对几个还有under 多少钱的转发
    rewrite (?i)/([^\/]+-dresses-under-[^\/]+\.html)(.*)$ /filter.php?route=$1 last;
    rewrite (?i)/([^\/]+-dresses-under-[^\/]+)\/?(.*)$ /filter.php?route=$1&filter=$2 last;

    # 商品页相关分类
    rewrite /abbuydress/[^\/]*-c([0-9]+)(.*)$ /filter.php?cat_id=$1&filter=$2 last;
    rewrite (?i)/[^\/]*-p-([0-9]+)\.html\/?$ /goods.php?goods_id=$1 last;

    # 商品 分类
    rewrite (?i)/UK-Store-Sale-[^\/]*-p-([0-9]+)\.html\/?$ /goods.php?goods_id=$1 last;
    rewrite (?i)/([^\/]+-dresses\.html)(.*)$ /filter.php?route=$1 last;
    rewrite (?i)/([^\/]+-dresses)\/?(.*)$ /filter.php?route=$1&filter=$2 last;

    error_page  404              /error.php;
    error_page   500 502 503 504  /50x.html;
    location = /50x.html {
        root   html;
    }
    location ~ /fi/(.*) {
        rewrite ^/fi/(.*)$ /$1?change_ln=fi last;
    }

    location ~ \.php$ {
        ssi on;
        fastcgi_pass   127.0.0.1:9000;
        fastcgi_index  index.php;

        fastcgi_param  APP_FS_ROOT D:/zwnmp/web/abbuydress/;
        fastcgi_param  V5_PATH $v5path;
        fastcgi_param  SCRIPT_FILENAME  D:/zwnmp/web/abbuydress$fastcgi_script_name;

        include        fastcgi_params;
    }
}